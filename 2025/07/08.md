## 取り組んだ課題一覧
- SQL
	- スッキリわかるSQL入門

	
## わかったこと
### サブクエリ

- `COUNT()`は、`列名`を指定するとNULLを無視し、`*`を指定するとNULLもカウントに含める
- サブクエリ（副問い合わせ）とは、他のSQL文の一部分に組み合わせるSELECT文のこと。丸括弧で囲って記述する。
- サブクエリで得られる結果は単一の値、複数の値、表の値の3種類がある
- 複数の値と比較するには、`ANY/ALL`演算子や`IN/NOT IN`演算子を用いる
- サブクエリの結果に`NULL`が入ってしまうと、通常の演算子で判定ができなくなってしまう。（`IS NOT NULL`を使用しなければ判定ができないため）そのため、サブクエリの結果から`NULL`を除外しておく必要がある。
- サブクエリの結果からNULLを除外するには、2通りの方法を使う
	- サブクエリの絞り込み条件(`WHERE`)に`IS NOT NULL`条件を含める
	- `COALESCE`関数を使ってNULLを別の値に置き換える
- 表形式の結果は`SELECT`文の`FROM`句や`INSEERT`文などに記述できる
- `INSEERT`文にサブクエリの表形式の結果を使うのは特殊構文で、括弧で囲わずに、`VALUES`のところを`SELECT`とする。
- `EXISTS`：サブクエリに結果が1行でもあれば真を返す
```
-- 家計簿集計テーブルから、家計簿にある費目のみを抽出する
SELECT 費目, 合計
  FROM 家計簿集計
 WHERE EXISTS (
      SELECT *
        FROM 家計簿
       WHERE 家計簿.費目 = 家計簿集計.費目
 )
```

### 複数テーブルの結合

- `JOIN(INNER JOIN) ON`：左右のテーブルを結合する（NULLの行は失われる）
- `LEFT JOIN`：左側のテーブルをもとに結合する（左のテーブルは全ての行を表示する）
- `RIGHT JOIN`：`LEFT JOIN`の逆
- `FULL JOIN`：左右のテーブルを結合する（NULLの行も全て表示する）
- `テーブル名 AS 短縮名`：テーブルに別名をつける
- 同じテーブルを結合することもできる。その場合は同じテーブルに異なる別名をつける。

### トランザクション

- SQL文のひとかたまりをトランザクションという。安全な操作のために、トランザクションの途中で処理が中断されない&ほかの人の処理が割り込めないようになっている。
- トランザクションに含まれる全てのSQL文は、必ず「全ての実行が完了している」または「ひとつも実行されていない」のどちらかの状態になるように制御される。
- トランザクション中のSQLによって書き換えられたデータは仮の状態として管理され、トランザクションが終了した時点で確定される。この動作をコミットという。
- トランザクション中に異常が発生して終了した場合、仮の状態はキャンセルされ無かったことになる。この動作をロールバックという。
- トランザクション指示は以下のとおり
	- `BEGIN`：トランザクションの開始
	- `COMMIT`：トランザクションの終了（確定）
	- `ROLLBACK`：トランザクションの終了（取消）
- 多くのDBはデフォルトで自動コミットモードになっている。
- トランザクションが実行される際、ほかのトランザクションから影響を受けないよう、それぞれは分離して実行される。
- あるトランザクションが現在読み書きしている行に鍵をかけ、ほかの人のトランザクションからは読み書きができないようにする。コミットまたはロールバックで終了すると、ほかのトランザクションでその行を読み書きできるようになる。
- ロックがかかることにより処理が遅くなる可能性があるため、トランザクション分離レベルが指定できるようになっている。
- `SELECT ~ FOR UPDATE (NOWAIT)`：明示的な行ロック
- `LOCK TABLE テーブル名 IN モード名 MODE (NOWAIT)`：明示的な表ロック
- デッドロックを防ぐには、できるだけ同じ順番で行やテーブルにロックがかかるようにする



## 次やること
- スッキリわかるSQL入門

## 感じたこと
テーブルの結合とサブクエリの組み合わせの問題が難しかったです。理解しきれていないところがあるので、書籍を読み終えたらもう一度やってみようと思います。


## 学習時間
今日:7h
今週:24h 
累計:581h