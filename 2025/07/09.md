## 取り組んだ課題一覧
- SQL
	- スッキリわかるSQL入門

	
## わかったこと

### テーブルの作成

- データ操作やテーブル操作の許可には権限を設定する（データベース管理者のみ使用できる）
- `GRANT 権限名 TO ユーザー名`：権限を付与する
- `REVOKE 権限名 FROM ユーザー名`：権限を剥奪する
```
-- テーブルの作成（基本形）
CREATE TABLE (IF NOT EXISTS)テーブル名（
	列名1 列1の型名,
	列名2 列2の型名,
	：
	列名X 列Xの型名
）
```
```
-- デフォルト値の指定を含むテーブルの作成
-- INSERT文で値が無かったとき、NULLではなくデフォルト値が自動で入力される
CREATE TABLE テーブル名（
	列名 列の型名 DEFAULT デフォルト値,
	：
）
```
- `DROP TABLE (IF EXISTS)テーブル名`：テーブルを削除する（処理は取り消しできないので注意する）
- `ALTER TABLE テーブル名 ADD 列名 型`：テーブルに列を追加する
- `ALTER TABLE テーブル名 DROP 列名`：テーブルの列を削除する
- テーブルには予期しない値を格納できないように制限をかけることができる
```
-- 制約の指定を含むテーブルの作成
CREATE TABLE テーブル名（
	列名 列の型名 制約の指定,
	：
）
```
- 制約の種類
	- `NOT NULL`：NULLは許可されない。必ず値を入れる。`NOT NULL`と`DEFAULT`を指定しておくと、入力が無かった場合に`DEFAULT`の値が入力されるのでエラーにならない。（`NOT NULL`がないと`NULL`を入力することができてしまう）
	- `UNIQUE`：重複は許可されない。（NULLは許可される。）
	- `CHECK(条件式)`：条件が真の場合、許可される。
	- `PRIMARY KEY`：主キー制約
	- `PRIMARY KEY(列名A, 列名B)`：複合主キーを設定する。`CREATE TABLE`文の最後に記述する

- 外部キーの参照先が存在しないことを参照整合性の崩壊という。このような状況は絶対に避けなければいけない。
- `REFERENCES`：外部キー制約をすることで、参照整合性が崩れるようなデータ操作をしようとした場合にエラーを発生させる。
```
-- 外部キー制約の指定
CREATE TABLE テーブル名（
	列名 列の型名 REFERENCES 参照先テーブル名(参照先列名),
	：
）
```
```
-- 外部キー制約の指定（CREATE 文の最後にまとめて書く場合）
CREATE TABLE テーブル名（
	：
	FOREIGN KEY (参照元列名)
		REFERENCES 参照先テーブル名(参照先列名),
）
```
- `TRUNCATE TABLE テーブル名`：テーブルの全行を削除する（一度DROPしてCREATEする）

### さまざまな支援機能

- インデックス
    - 列名に対して索引情報(index)をつけると検索速度が速くなる
	- `CREATE INDEX インデックス名 ON テーブル名(列名)`：インデックスを作成する
	- `DROP INDEX インデックス名`：インデックスを削除する
	- インデックスは索引情報を保存するためディスク容量を消費したり、データの変更によりインデックスも書き換える必要がありオーバーヘッドが増加するため、乱用しないようにする。
	- ほとんどのDBMSは、PRIMARY KEY制約を設定した列に、自動的にインデックスを作成する
- ビュー(view)
	- ビューは結果表をテーブルのように使用できるため、同じクエリを何度も書かなくてよくなる。また権限と組み合わせることで、データ参照を許可する範囲を柔軟に定めることができる。ビューの実態は、名前をつけたSELECT文である。
	- `CREATE VIEW ビュー名 AS SELECT文`：ビューを作成する
	- `DROP VIEW ビュー名`：ビューを削除する
- `GENERATED ALWAYS AS IDENTITY PRIMARY KEY`：テーブル作成時に主キーに記述することで、自動で連番をとってくれる（DBの種類によりこの文は異なる）
- 採番した最新の値を記録するにはシーケンスを使用する
- ASID特性とは、データを正確・安全に取り扱うためにシステムが備えるべき4つの特性（原子性、一貫性、分離性、永続性）のこと。
- 多くのDBMSはデータの消失に備えてバックアップの仕組みを備えている。
- ログに記録されているSQL文を再実行して、障害が発生する直前の状態までデータを更新する処理をロールフォワードという。


### テーブルの設計

- データベース設計作業は、概念設計、論理設計、物理設計の順番で進めていく。
- 概念設計
	- 管理すべき情報の塊をエンティティ(テーブルのようなもの)という。エンティティは複数の属性（列のようなもの）を持つ。エンティティを洗い出し、エンティティ同士の関連についても明らかにする。
	- 概念設計の成果はER図にまとめる。
	- 概念設計をいきなり完璧に行うことは難しいので、まずは概念設計の目的や流れの把握に専念する。
	- エンティティの中にエンティティを作る二重構造は行わない
- 論理設計
	- 論理設計の目的は、概念上のエンティティを取り扱いやすい形のテーブルに変形すること
	- 多対多のデータはうまく扱えないため、2つのエンティティの対応を格納した中間テーブルを追加して、2つの1対多の関係に変換する
	- 全てのキーの整理と確認を行う。特に、主キーを持たないエンティティには管理をしやすくするために人工的な主キーを追加する
	- 正規化を行う。正規化とは、矛盾したデータを格納できないよう、テーブルを複数に分割すること。
	- 一つの事実は１箇所に書く。
	- 正規化によってテーブルが適切に分割された状態を正規形という。正規化には第5正規形まであり、一般的には第3正規形までおこなう。
	- 非正規形：セルの結合が含まれている状態
	- 第1正規形：全ての行列にひとつずつ値が入っている
	- 第2正規形：複合主キーを持つテーブルの場合、非キー列は、複合主キーの全体に関数従属すべきである
	- 第3正規形：非キー列は主キーに直接、関数従属すべきである
	- 論理設計の終了条件は、システムに必要なすべてのテーブルと列をもれなく明らかにすること
- 物理設計
	- 1.最終的なテーブル名と列名を決定する
	- 2.列の型を決定する
	- 3.制約、デフォルト値を決定する
	- 4.インデックスを決定する
	- 5.その他　ビューの作成や正規化を崩す、巨大なテーブルの分割など
- テーブルを設計するには、お客様の理想を起点とするトップダウンアプローチと、お客様の現実を起点とするボトムアップアプローチを組み合わせて見落としを防ぐことが必要。


## 次やること
- スッキリわかるSQL入門

## 感じたこと
テーブルの設計について、顧客の要件をどのように実現するかの手順が学べたのでよかったです。きれいなテーブルを作るには訓練が必要だと思いました。顧客の要件とデータベース技術の両方を理解し、より良いシステムが作れるようになりたいと思いました。


## 学習時間
今日:6h
今週:30h 
累計:587h