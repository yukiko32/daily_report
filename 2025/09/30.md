## 取り組んだ課題一覧
- Next.js公式チュートリアル

	
## わかったこと

###### useActionStateつづき

- Zodを使用してフォームデータを検証する
```
// /app/lib/actions.ts
const FormSchema = z.object({
  id: z.string(),
  customerId: z.string({
    invalid_type_error: 'Please select a customer.',
  }),
  amount: z.coerce
    .number()
    .gt(0, { message: 'Please enter an amount greater than $0.' }),
  status: z.enum(['pending', 'paid'], {
    invalid_type_error: 'Please select an invoice status.',
  }),
  date: z.string(),
});
```

- `createInvoice`アクションで`prevState`と`formData`の2つのパラメータを受け取る。`prevState`は必須の引数となるため、関数内で使用しなくても受け取る必要がある。
```
export type State = {
  errors?: {
    customerId?: string[];
    amount?: string[];
    status?: string[];
  };
  message?: string | null;
};
 
export async function createInvoice(prevState: State, formData: FormData) {
  // ...
}
```
- `safeParse()`は、定義したスキーマを元に入力値を検証し、successまたはerrorフィールドのいずれかを含むオブジェクトを返す。`formData.get('name属性')`はフォームで送られてきたデータのname属性が合致するものの入力値を取得する。

```
export async function createInvoice(prevState: State, formData: FormData) {
  // Validate form fields using Zod
  const validatedFields = CreateInvoice.safeParse({
    customerId: formData.get('customerId'),
    amount: formData.get('amount'),
    status: formData.get('status'),
  });
 
  // ...
}
```
- `validatedFields`が成功以外を返した場合はreturnして終了する
```
if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
      message: 'Missing Fields. Failed to Create Invoice.',
    };
  }
```
- `validatedFields.error.flatten().fieldErrors`入力値が空白の場合に以下のようなエラーを返すので、呼び出し側では`state.errors.customerId`のようにしてエラーメッセージを取得できる
```
// {
      //   customerId: ["Please select a customer."],
      //   amount: ["Please enter an amount greater than $0."],
      //   status: ["Please select an invoice status."]
// }
```
- `aria-**`をタグに記述することで、アクセシビリティを向上できる
```
// この要素の補足説明がidがcustomer-errorの要素で行われていることを示す
aria-describedby="customer-error"
// 内容が変わったら操作を邪魔しないタイミングで読み上げる
aria-live="polite"
// 変更時に変更部分だけではなく要素全体を読み上げる
aria-atomic="true"
```

#### 認証


- 認証：ユーザーが自分が誰であるかを確認すること。ユーザー名やパスワードなど、自分が持っているもので身元を証明する。
- 承認：アプリケーションのどの部分が使用が許可されているかは、認証によって決定される。


##### NextAuth.js

- インストール
```
pnpm i next-auth@beta
```
- 秘密鍵を生成する（クッキーの暗号化とユーザーセッションのセキュリティ確保に使用）
```
openssl rand -base64 32
```
- `.env`ファイルで生成したキーを`AUTH_SECRET`変数に追加
```
AUTH_SECRET=your-secret-key
```
- Vercelに環境変数を設定する
	- プロジェクト選択→設定→環境変数→Key: AUTH_SECRETとValue: シークレットキーを設定して保存→再デプロイまたは`git push`



## 次やること
- Next.js公式チュートリアル


## 感じたこと
useActionStateを使ったフォーム検証、NextAuth.jsの認証機能について学習しました。
コードが難しくて理解に時間がかかっています。認証機能についてはまだ理解できていないので、引き続き復習していきます。


## 学習時間
今日:3.5h
今週:23h 
累計:1127.5h